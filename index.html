<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="/src/styles.css" />
  <link rel="stylesheet" href="/fonts.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@9.4.0/dist/css/shepherd.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ghostwriter</title>
  <script type="module" src="/src/main.js" defer></script>
  <script type="module" src="/src/url-panel.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/shepherd.js@9.4.0/dist/js/shepherd.min.js"></script>
</head>

<body>
  
  <main class="container">
    <!-- URL Top Panel -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@9.4.0/dist/css/shepherd.css">
    <div id="url-panel" class="url-panel-hidden border-[0.5px] relative w-full z-50 rounded-sm">
      <div class="flex items-center gap-2 p-2">
        <input type="text" autocomplete="false" spellcheck="false" autocapitalize="false" id="url-input" placeholder="Enter URL..." class="w-3/4  !bg-white !rounded-[1px] flex-grow !p-1 !text-[0.8em] !font-['Haffer'] !border-[0.1px]">
        <span id="url-submit-btn" class="diagnostics-area-button enabled whitespace-nowrap min-w-[4rem]">INGST</span>
  <script src="https://cdn.jsdelivr.net/npm/shepherd.js@9.4.0/dist/js/shepherd.min.js"></script>
        <span id="url-close-btn" class="diagnostics-area-button enabled min-w-[2.5rem] text-center">Ã—</span>
      </div>
    </div>
  <button id="show-tour-btn" class="diagnostics-area-button enabled" style="position: absolute; top: 12px; right: 12px; z-index: 1000;">Show Tour</button>
    
    
    
    <div class="scroll-area">
      <div id="floating-timer" class="floating-timer">
        00:00
      </div>
      <div autocomplete="false" spellcheck="false" autocapitalize="false" id="main-editor" class="element"></div>
    </div>
  </div>
  
  <!-- Add the resize handle -->
  <div class="resize-handle" title="Drag to resize"></div>
  
  <div class="diagnostics-scroll-area bg-transparent">
    
    <div class="bg-gray-200 bg-gray-200 border-[0.5px] rounded-sm mb-1">
      
      <!-- First row of buttons -->
      <div id="action-buttons-row-1" class="diagnostics-btn-area text-[0.8em] w-full  pl-4">
        <span id="incant-btn" class="diagnostics-area-button enabled">INCNT</span>
        <span id="vibe-mode-btn" class="diagnostics-area-button enabled">VIBEM</span>
        <span id="streaming-mode-btn" class="diagnostics-area-button enabled">STRMC</span>
        <!-- <div class="bg-gray-500 rounded-md w-[4px] h-full block mx-[-0.1em] translate-y-[0.1em] translate-x-[0.1em]"></div> -->
        <span id="nudge-inline-action-item" class="diagnostics-area-button enabled">NUDGE</span>
        <span id="simplify-btn" class="diagnostics-area-button disabled">SMLFY</span>
        <span id="panel-toggle-btn" class="diagnostics-area-button enabled">PREFS</span>
        <span class="diagnostics-area-button disabled">ARM-A</span>
        <span class="diagnostics-area-button disabled">ARM-B</span>
        <span class="diagnostics-area-button disabled">CMPSE</span>
        <span class="diagnostics-area-button disabled">EXCVT</span>

      </div>
      <!-- Second row of buttons -->
      <div id="action-buttons-row-2" class="diagnostics-btn-area  text-[0.8em] w-full ">
        <span id="list-canon-btn" class="diagnostics-area-button enabled">CANON</span>
        <span id="ingest-btn" class="diagnostics-area-button enabled">INGST</span>
        <span id="ingest-url-btn" class="diagnostics-area-button enabled">NGSTU</span>
        <span id="similarity-search-btn" class="diagnostics-area-button enabled">SSRCH</span>
        <span id="streaming-no-rag-mode-btn" class="diagnostics-area-button disabled">SPEAK</span>
        <span id="clear-diagnostics-btn" class="diagnostics-area-button enabled">CLEAR</span>
        <span id="reset-rag-btn" class="diagnostics-area-button enabled">RESET</span>
        <span id="open-log-btn" class="diagnostics-area-button enabled">LOGJS</span>
        <span class="diagnostics-area-button disabled">GENRT</span>
        <span class="diagnostics-area-button disabled">MSTRM</span>

      </div>
    </div>
    <!-- diagnostics editor and the rest follow as before -->
    <div id="diagnostics-editor" class="diagnostics-content bg-blue-700 h-full bg-2 rounded-sm">
      <div class="diagnostics bg-blue-700 rounded-sm mb-2"></div>
    </div>
    <div class="w-full grid grid-cols-[1fr_auto] gap-2 items-stretch mb-2 mt-1">
      <div class="h-[2em] flex items-center bg-gray-200 border-[0.5px] pl-2 w-full rounded-sm">
        <span id="greet-msg" class="greet-msg">Hello.</span>
      </div>
      <div id="icon-area" class="flex items-center justify-end bg-gray-200 border-[0.5px] rounded-sm w-fit px-2" >
        <img class="h-[1.5em] m-[0.1em]" src="/images/icons/LaboratoryCircle_Guy_01_CircleTeal.webp" />
        <div id="vibe-status-indicator" class="text-[25px] ml-2 opacity-90">ðŸ§ </div>
      </div>
    </div>
  </div>
  <!-- Add the side panel -->
  <div id="side-panel" class="side-panel w-full">
    <div class="text-[0.8em] fuppercase font-[InputMonoNarrow]  mb-1 w-full mx-auto text-center">Incantation Preferences & Parameters</div>
    <div class="fixed-buttons">
      <div class="grid grid-cols-4 gap-1 w-1/2 mb-0 mx-auto">
        <div id="prefs-load-btn" class="diagnostics-area-button enabled">LOAD</div>
        <div id="prefs-save-btn" class="diagnostics-area-button enabled">SAVE</div>
        <div id="prefs-reset-btn" class="diagnostics-area-button enabled">RSET</div>
        <div id="prefs-close-btn" class="diagnostics-area-button enabled">CLOSE</div>
      </div>
    </div>
    <div class="side-panel-content mx-auto p-2 mb-0 w-full bg-gray-400">
      <label class="form-control">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">Main Prompt</span>
        </div>
        <textarea id="prefs-main-prompt" type="text" placeholder="Main Prompt" class="text-pretty w-full h-[200px] text-[0.7em] leading-normal font-[ESKlarheitKurrentMono] mb-4 textarea textarea-primary overscroll-none"></textarea>
      </label>
      <label class="form-control">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">Response Limit</span>
        </div>
        <textarea id="prefs-response-limit" type="text" placeholder="Response Limit" class="text-pretty w-full h-[100px] text-[0.7em] leading-normal font-[ESKlarheitKurrentMono] mb-4 textarea textarea-primary overscroll-none"></textarea>
      </label>
      <label class="form-control">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow]  ml-1">Final Preamble</span>
        </div>
        <textarea id="prefs-final-preamble" type="text" placeholder="Final Preamble" class="text-pretty w-full h-[100px] text-[0.7em] leading-normal font-[ESKlarheitKurrentMono] mb-4 textarea textarea-primary overscroll-none"></textarea>
      </label>
      <label class="form-control">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">Prose Style</span>
        </div>
        <textarea id="prefs-prose-style" type="text" placeholder="Prose Style" class="text-pretty w-full h-[24px] text-xs font-[ESKlarheitKurrentMono] textarea textarea-primary overscroll-none mb-4"></textarea>
      </label>
      <label class="form-control mt-2">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow]  ml-1">Vibe Mode Context</span>
        </div>
        <textarea id="prefs-vibe-mode-context" type="text" placeholder="Vibe Mode Context" class="text-pretty w-full h-[148px] text-xs font-[ESKlarheitKurrentMono] textarea textarea-primary overscroll-none"></textarea>
      </label>
      
      <div class="my-4">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow]  ml-1">Vibe Mode Genre</span>
        </div>
        <div class="vibe-genre-selection grid grid-cols-1 gap-2 border border-gray-300 rounded-md p-3 bg-gray-50 text-black dark:bg-gray-800 dark:text-white ">
          <label class="radio-label cursor-pointer flex items-center gap-2">
            <input type="radio" name="vibe-genre" value="HARDBOILED" class="radio radio-sm">
            <span class="text-[0.8em]">Hardboiled Detective</span>
          </label>
          <!-- <label class="radio-label cursor-pointer flex items-center gap-2">
            <input type="radio" name="vibe-genre" value="POETRY" class="radio radio-sm">
            <span class="text-[0.8em]">Poetry</span>
          </label> -->
          <label class="radio-label cursor-pointer flex items-center gap-2">
            <input type="radio" name="vibe-genre" value="SOLARPUNK" class="radio radio-sm">
            <span class="text-[0.8em]">Solarpunk</span>
          </label>
          <label class="radio-label cursor-pointer flex items-center gap-2">
            <input type="radio" name="vibe-genre" value="ROMANTICCOMEDY" class="radio radio-sm">
            <span class="text-[0.8em]">Romantic Comedy</span>
          </label>
          <label class="radio-label cursor-pointer flex items-center gap-2">
            <input type="radio" name="vibe-genre" value="CYBERPUNK" class="radio radio-sm">
            <span class="text-[0.8em]">Cyberpunk</span>
          </label>
          <label class="radio-label cursor-pointer flex items-center gap-2">
            <input type="radio" name="vibe-genre" value="FANTASY" class="radio radio-sm">
            <span class="text-[0.8em]">Fantasy</span>
          </label>
        </div>
      </div>
      
      <!-- Daisy toggle doesn't work maybe beta issues? So this is my own -->
      <div class="my-10 grid grid-cols-2 gap-4 w-[50%]">
        <!-- RAG Shuffle Toggle -->
        <label class="form-control toggle-switch flex items-center">
          <div class="label">
            <span class="label-text text-sm font-[InputMonoNarrow] ml-0">RAG SHFL</span>
          </div>
          <input id="prefs-shuffle-similars" type="checkbox" />
          <span class="slider"></span>
        </label>
        <!-- STRM RAG Toggle -->
        <label class="form-control toggle-switch flex items-center">
          <div class="label">
            <span class="label-text text-sm font-[InputMonoNarrow]">STRM RAG</span>
          </div>
          <input id="prefs-strm-rag" type="checkbox" />
          <span class="slider"></span>
        </label>
      </div>
      
      <label class="form-control my-4 block">
        <div class="label">
          <span class="label-text text-sm font-[InputMonoNarrow] ml-1">SIMILARITY THRESHOLD</span>
        </div>
        <div class="grid grid-cols-12 gap-2">
          <div class="col-span-9">
            <input id="prefs-similarity-treashold" type="range" min="0" max="100" value="82" class="range" step="1" />
          </div>
          <div class="col-span-3">
            <span id="prefs-similarity-treashold-value" class="ghost-text">.82</span>
          </div>
        </div> 
      </label>
      
      
      
      <label class="form-control my-4 block">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">Similarity Count (RAG Results To Use)</span>
        </div>
        
        <div class="grid grid-cols-12 gap-2">
          <div class="col-span-9">
            <input id="prefs-similarity-count" type="range" min="1" max="10" class="range" step="1" />
          </div>
          <div class="col-span-3">
            <span id="prefs-similarity-count-value" class="ghost-text">3</span>
          </div>
        </div>
      </label>
      
      <label class="form-control my-4 block">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">Temperature</span>
        </div>
        
        <div class="grid grid-cols-12 gap-2">
          <div class="col-span-9">
            <input id="prefs-temperature" type="range" min="0" max="2" class="range" step="0.1" />
          </div>
          <div class="col-span-3">
            <span id="prefs-temperature-value" class="ghost-text"></span>
          </div>
        </div>
      </label>
      
      <!-- MAX OUTPUT TOKENS-->
      <label class="form-control my-4 block">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow]  ml-1">Max Output Tokens</span>
        </div>
        <div class="grid grid-cols-12 gap-2">
          <div class="col-span-9">
            <input id="prefs-max-output-tokens" type="range" min="50" max="800" value="100" class="range" step="25" />
          </div>
          <div class="col-span-3">
            <span id="prefs-max-output-tokens-value" class="ghost-text">100</span>
          </div>
        </div>
      </label>
      
      <!-- MAX HISTORY ITEMS -->
      <label class="form-control my-4 block">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">Max History Items</span>
        </div>
        <div class="grid grid-cols-12 gap-2">
          <div class="col-span-9">
            <input id="prefs-max-history-items" type="range" min="0" max="300" value="50" class="range" step="1" />
          </div>
          <div class="col-span-3">
            <span id="prefs-max-history-items-value" class="ghost-text">50</span>
          </div>
        </div>
      </label>
      
      <label class="form-control my-4 block">
        <div class="label">
          <span class="label-text text-sm uppercase font-[InputMonoNarrow]  ml-1">Vibe Mode Timer</span>
        </div>
        <div class="grid grid-cols-12 gap-2">
          <div class="col-span-9">
            <input id="prefs-game-time-secs" type="range" min="0" max="90" value="20" class="range" step="5" />
          </div>
          <div class="col-span-3">
            <span id="prefs-game-time-secs-value" class="ghost-text">20</span>
          </div>
        </div>
      </label>
      
      <!-- Little spot to put in OpenAI API Key -->
      <div class="label">
        <span class="label-text text-sm uppercase font-[InputMonoNarrow]  ml-1">OpenAI API Key</span>
      </div>
      <label class="input input-bordered flex items-center gap-2">
        <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 16 16"
        fill="currentColor"
        class="h-4 w-4 opacity-70">
        <path
        fill-rule="evenodd"
        d="M14 6a4 4 0 0 1-4.899 3.899l-1.955 1.955a.5.5 0 0 1-.353.146H5v1.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-2.293a.5.5 0 0 1-.146-.353l3.955-3.955A4 4 0 1 1 14 6Zm-4-2a.75.75 0 0 0 0 1.5.5.5 0 0 1 .5.5.75.75 0 0 0 1.5 0 2 2 0 0 0-2-2Z"
        clip-rule="evenodd" />
      </svg>
      <div class="flex grow items-center !shadow-none">
        <span class="text-gray-500 select-none">sk-</span>
        <input 
        id="openai-api-key" 
        type="text" 
        class="grow !shadow-none border-none focus:outline-none font-mono text-xs placeholder:text-gray-400 placeholder:text-xs placeholder:font-mono" 
        placeholder="paste your API key here"
        />
      </div>
    </label>
  </div>
  <!-- Add this after "Prose Style" section and before the RAG Shuffle toggle -->
  
  <div id="llm-preferences" class="mt-8 mb-4 px-8 pt-2 bg-amber-400/10">
    <div class="label">
      <div class="label-text text-sm uppercase font-[InputMonoNarrow]  ml-1 mb-4">AI Provider</div>
    </div>
    <div class="provider-selection flex gap-3 mb-2">
      <label class="radio-label cursor-pointer flex items-center gap-1">
        <input type="radio" name="ai-provider" value="ollama" id="provider-ollama" class="radio radio-md">
        <span class="text-[0.8em] uppercase font-[InputMonoNarrow] ">Ollama</span>
      </label>
      <label class="radio-label cursor-pointer flex items-center gap-1">
        <input type="radio" name="ai-provider" value="openai" id="provider-openai" class="radio radio-md">
        <span class="text-[0.8em] uppercase font-[InputMonoNarrow] ">OpenAI</span>
      </label>
      <label class="radio-label cursor-pointer flex items-center gap-1">
        <input type="radio" name="ai-provider" value="lmstudio" id="provider-lmstudio" class="radio radio-md">
        <span class="text-[0.8em] uppercase font-[InputMonoNarrow] ">LM Studio</span>
      </label>
    </div>
    
    <!-- LM Studio URL - only visible when LM Studio is selected -->
    <div id="lmstudio-url-container" class="hidden mb-3">
      <div class="label">
        <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">LM Studio URL</span>
      </div>
      <input type="text" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off" id="prefs-lmstudio-url" placeholder="http://localhost:1234/v1" 
      class="w-full text-[0.7em] font-[ESKlarheitKurrentMono] p-1.5 input input-bordered">
    </div>
    
    <div id="ollama-url-container" class="hidden mb-3">
      <div class="label">
        <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">Ollama URL</span>
      </div>
      <input type="text" id="prefs-ollama-url" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off"   placeholder="http://localhost:114321" 
      class="w-full text-[0.7em] font-[ESKlarheitKurrentMono] p-1.5 input input-bordered">
    </div>
    
    <!-- Model Selection Dropdown -->
    <div class="my-3">
      <div class="label">
        <span class="label-text text-sm uppercase font-[InputMonoNarrow] ml-1">Available Models</span>
      </div>        
    </div>
    <div id="models-container" class="relative mb-[2rem] flex items-center gap-2">
      <select id="prefs-model-name" class="select h-[2rem] rounded-none !border-none focus:border-none focus-visible:ring-[0.1px] focus-visible:ring-gray-300">
        <option value="" class="font-mono text-xs">Loading models...</option>
      </select>
      <!-- <button id="refresh-models-btn" class="text-[1.5em] p-0.5 px-2 rounded bg-gray-200 hover:bg-gray-300" title="Refresh available models">Reload</button> -->
      <div id="refresh-models-btn" class="diagnostics-area-button enabled">LOAD</div>
    </div>
    
    
  </div>
  
  <button id="show-tour-btn" class="diagnostics-area-button enabled">Show Tour</button>
</div>
</main>
</body>
</html>